<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>3D Modeling 101</title>
    <style>
        :root {
            --primary: #3498db;
            --success: #2ecc71;
            --error: #e74c3c;
            --dark: #2c3e50;
            --bg: #f0f2f5;
            --text: #333;
            --card: #ffffff;
            --card-muted: #f8f9fa;
            --border: #e4e7eb;
        }

        @media (prefers-color-scheme: dark) {
            :root {
                --bg: #0f1115;
                --text: #e6e6e6;
                --card: #151922;
                --card-muted: #1c2230;
                --border: #2a3344;
                --dark: #111827;
            }
        }

        body {
            font-family: 'Segoe UI', system-ui, sans-serif;
            background: var(--bg);
            color: var(--text);
            line-height: 1.6;
            margin: 0;
            padding: 20px;
        }
        .wrapper {
            max-width: 900px;
            margin: 0 auto;
            background: var(--card);
            padding: 40px;
            border-radius: 20px;
            box-shadow: 0 10px 30px rgba(0,0,0,0.1);
            border: 1px solid var(--border);
        }

        /* Theory Cards */
        .grid {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(250px, 1fr));
            gap: 20px;
            margin: 30px 0;
        }
        .card {
            padding: 20px;
            background: var(--card-muted);
            border-left: 5px solid var(--primary);
            border-radius: 8px;
        }

        /* 3D Lab */
        #lab-container {
            background: #111;
            border-radius: 12px;
            position: relative;
            margin: 30px 0;
            overflow: hidden;
            border: 1px solid #222;
        }
        #viewport { width: 100%; height: 400px; cursor: move; }
        .nav-tabs { display: flex; background: #222; padding: 10px; gap: 5px; }
        .tab-btn {
            flex: 1; padding: 10px; border: none; background: #444; color: white;
            cursor: pointer; border-radius: 4px; font-size: 0.9rem;
        }
        .tab-btn.active { background: var(--primary); }

        /* Quiz */
        .quiz-box {
            background: var(--dark);
            color: white;
            padding: 30px;
            border-radius: 12px;
            margin-top: 40px;
        }
        .quiz-meta {
            display: flex;
            gap: 12px;
            flex-wrap: wrap;
            margin: 10px 0 20px;
            font-size: 0.95rem;
            color: #cbd5e1;
        }
        .progress-bar {
            height: 8px;
            background: rgba(255,255,255,0.15);
            border-radius: 999px;
            overflow: hidden;
        }
        .progress-fill {
            height: 100%;
            width: 0%;
            background: var(--primary);
            transition: width 200ms ease;
        }
        .opt-btn {
            background: rgba(255,255,255,0.1);
            color: white;
            border: 1px solid rgba(255,255,255,0.2);
            padding: 12px 20px;
            border-radius: 6px;
            cursor: pointer;
            margin: 5px 0;
            display: block;
            width: 100%;
            text-align: left;
        }
        .opt-btn:hover { background: rgba(255,255,255,0.2); }
        .correct { background: var(--success) !important; border-color: var(--success); }
        .wrong { background: var(--error) !important; border-color: var(--error); }

        .quiz-actions {
            display: flex;
            gap: 10px;
            margin-top: 15px;
            flex-wrap: wrap;
        }
        .action-btn {
            background: var(--primary);
            color: white;
            border: none;
            padding: 10px 16px;
            border-radius: 6px;
            cursor: pointer;
            font-weight: 600;
        }
        .action-btn.secondary { background: rgba(255,255,255,0.15); }

        .result-box {
            margin-top: 15px;
            padding: 12px 14px;
            background: rgba(255,255,255,0.1);
            border-radius: 8px;
        }
        .result-row { display: flex; justify-content: space-between; gap: 10px; }
        .result-label { color: #cbd5e1; }
    </style>
</head>
<body>

<div class="wrapper">
    <header style="text-align: center;">
        <h1>The Anatomy of 3D</h1>
        <p>Before you can sculpt a masterpiece, you must understand the "Geometry Trinity."</p>
    </header>

    <section class="theory">
        <div class="grid">
            <div class="card">
                <h3>1. The Vertex</h3>
                <p>A mathematical point in space. It has no size, just coordinates: <strong>(X, Y, Z)</strong>.</p>
            </div>
            <div class="card">
                <h3>2. The Edge</h3>
                <p>A straight line connecting two vertices. Edges form the <strong>Wireframe</strong> of your model.</p>
            </div>
            <div class="card">
                <h3>3. The Face</h3>
                <p>The surface that fills the gap between 3 or more edges. This is the <strong>"Skin"</strong> that reflects light.</p>
            </div>
        </div>
    </section>

    <div id="lab-container">
        <div class="nav-tabs">
            <button class="tab-btn active" onclick="updateScene('vertex', this)">1. View Vertex</button>
            <button class="tab-btn" onclick="updateScene('edge', this)">2. View Edge</button>
            <button class="tab-btn" onclick="updateScene('face', this)">3. View Face</button>
            <button class="tab-btn" onclick="updateScene('mesh', this)">4. View Full Mesh</button>
        </div>
        <div id="viewport"></div>
    </div>

    <section class="quiz-box">
        <h3>Final Challenge</h3>
        <div class="quiz-meta">
            <span id="q-count">Question 1 of 6</span>
            <span id="q-score">Score: 0%</span>
        </div>
        <div class="progress-bar"><div class="progress-fill" id="progress-fill"></div></div>
        <p id="q-text" style="margin-top: 16px;"></p>
        <div id="quiz-options"></div>
        <div class="quiz-actions">
            <button class="action-btn secondary" id="retry-btn" onclick="resetQuiz()">Retry Quiz</button>
            <button class="action-btn" id="next-btn" onclick="nextQuestion()" disabled>Next</button>
        </div>
        <div class="result-box" id="result-box" style="display:none;">
            <div class="result-row"><span class="result-label">Success rate</span><span id="result-rate"></span></div>
            <div class="result-row"><span class="result-label">Medal</span><span id="result-medal"></span></div>
            <div class="result-row"><span class="result-label">Points</span><span id="result-points"></span></div>
        </div>
        <p id="feedback" style="margin-top: 12px; min-height: 25px;"></p>
    </section>
</div>

<script type="importmap">
    { "imports": { "three": "https://unpkg.com/three@0.160.0/build/three.module.js", "three/addons/": "https://unpkg.com/three@0.160.0/examples/jsm/" } }
</script>

<script type="module">
    import * as THREE from 'three';
    import { OrbitControls } from 'three/addons/controls/OrbitControls.js';

    const container = document.getElementById('viewport');
    const scene = new THREE.Scene();
    const camera = new THREE.PerspectiveCamera(50, container.clientWidth / container.clientHeight, 0.1, 1000);
    const renderer = new THREE.WebGLRenderer({ antialias: true });
    renderer.setSize(container.clientWidth, container.clientHeight);
    container.appendChild(renderer.domElement);

    const controls = new OrbitControls(camera, renderer.domElement);
    camera.position.set(3, 3, 5);

    // Light
    const light = new THREE.DirectionalLight(0xffffff, 2);
    light.position.set(5, 5, 5);
    scene.add(light, new THREE.AmbientLight(0x404040));

    let currentObj = null;

    window.updateScene = function(type, btn) {
        document.querySelectorAll('.tab-btn').forEach(b => b.classList.remove('active'));
        btn.classList.add('active');
        if (currentObj) scene.remove(currentObj);

        if (type === 'vertex') {
            const geo = new THREE.BufferGeometry().setAttribute('position', new THREE.Float32BufferAttribute([0,0,0], 3));
            currentObj = new THREE.Points(geo, new THREE.PointsMaterial({ color: 0xffffff, size: 0.25 }));
        } else if (type === 'edge') {
            const geo = new THREE.BufferGeometry().setAttribute('position', new THREE.Float32BufferAttribute([-1,0,0, 1,0,0], 3));
            currentObj = new THREE.Line(geo, new THREE.LineBasicMaterial({ color: 0x00ff88, linewidth: 3 }));
        } else if (type === 'face') {
            const shape = new THREE.Shape();
            shape.moveTo(-1, -1); shape.lineTo(1, -1); shape.lineTo(0, 1);
            currentObj = new THREE.Mesh(new THREE.ShapeGeometry(shape), new THREE.MeshPhongMaterial({ color: 0x3498db, side: THREE.DoubleSide }));
        } else {
            const geo = new THREE.SphereGeometry(1.5, 12, 12);
            const group = new THREE.Group();
            group.add(new THREE.Mesh(geo, new THREE.MeshPhongMaterial({ color: 0x3498db, flatShading: true })));
            group.add(new THREE.Mesh(geo, new THREE.MeshBasicMaterial({ color: 0xffffff, wireframe: true })));
            currentObj = group;
        }
        scene.add(currentObj);
    };

    updateScene('vertex', document.querySelector('.tab-btn'));

    function animate() {
        requestAnimationFrame(animate);
        if (currentObj) currentObj.rotation.y += 0.005;
        controls.update();
        renderer.render(scene, camera);
    }
    animate();
</script>

<script>
    const quiz = [
        {
            text: 'Which component creates the visible surface of a 3D model?',
            options: ['Vertex', 'Edge', 'Face', 'Axis'],
            correctIndex: 2
        },
        {
            text: 'What is a vertex?',
            options: ['A flat surface', 'A single point in space', 'A curved edge', 'A 3D tool'],
            correctIndex: 1
        },
        {
            text: 'What does an edge connect?',
            options: ['Faces to faces', 'Vertices to vertices', 'Models to models', 'Planes to planes'],
            correctIndex: 1
        },
        {
            text: 'A sketch is best described as:',
            options: ['A 3D object', 'A 2D drawing on a plane', 'A camera view', 'A lighting setup'],
            correctIndex: 1
        },
        {
            text: 'Which action turns a sketch into a 3D form?',
            options: ['Extrude', 'Zoom', 'Pan', 'Orbit'],
            correctIndex: 0
        },
        {
            text: 'Which basic shape would you start with for a ball?',
            options: ['Cube', 'Cylinder', 'Sphere', 'Pyramid'],
            correctIndex: 2
        }
    ];

    let currentIndex = 0;
    let correctCount = 0;
    let answered = false;

    const qText = document.getElementById('q-text');
    const qCount = document.getElementById('q-count');
    const qScore = document.getElementById('q-score');
    const optionsEl = document.getElementById('quiz-options');
    const feedback = document.getElementById('feedback');
    const nextBtn = document.getElementById('next-btn');
    const progressFill = document.getElementById('progress-fill');
    const resultBox = document.getElementById('result-box');
    const resultRate = document.getElementById('result-rate');
    const resultMedal = document.getElementById('result-medal');
    const resultPoints = document.getElementById('result-points');

    function renderQuestion() {
        const q = quiz[currentIndex];
        qText.textContent = q.text;
        qCount.textContent = `Question ${currentIndex + 1} of ${quiz.length}`;
        qScore.textContent = `Score: ${Math.round((correctCount / quiz.length) * 100)}%`;
        progressFill.style.width = `${((currentIndex) / quiz.length) * 100}%`;
        optionsEl.innerHTML = '';
        feedback.textContent = '';
        answered = false;
        nextBtn.disabled = true;

        q.options.forEach((opt, i) => {
            const btn = document.createElement('button');
            btn.className = 'opt-btn';
            btn.textContent = opt;
            btn.onclick = () => verify(btn, i === q.correctIndex);
            optionsEl.appendChild(btn);
        });
    }

    function getMedal(score) {
        if (score >= 98 || score === 100) return 'Platinum';
        if (score >= 85) return 'Gold';
        if (score >= 70) return 'Silver';
        return 'Bronze';
    }

    function getPoints(medal) {
        const pointsMap = { Bronze: 3, Silver: 5, Gold: 13, Platinum: 25 };
        return pointsMap[medal] || 0;
    }

    function verify(btn, isCorrect) {
        if (answered) return;
        answered = true;
        document.querySelectorAll('.opt-btn').forEach(b => b.className = 'opt-btn');
        if (isCorrect) {
            btn.className = 'opt-btn correct';
            feedback.textContent = 'Correct!';
            feedback.style.color = '#2ecc71';
            correctCount += 1;
        } else {
            btn.className = 'opt-btn wrong';
            feedback.textContent = 'Not quite. Review the lesson and try the next one.';
            feedback.style.color = '#ff7675';
        }
        nextBtn.disabled = false;
        qScore.textContent = `Score: ${Math.round((correctCount / quiz.length) * 100)}%`;
    }

    function showResults() {
        const score = Math.round((correctCount / quiz.length) * 100);
        const medal = getMedal(score);
        const points = getPoints(medal);
        resultRate.textContent = `${score}%`;
        resultMedal.textContent = medal;
        resultPoints.textContent = `${points} points`;
        resultBox.style.display = 'block';
        progressFill.style.width = '100%';

        if (window.parent) {
            window.parent.postMessage({
                type: 'html-game-complete',
                game: '3d-modeling-first-principle',
                score: score,
                medal: medal,
                points: points
            }, '*');
        }
    }

    window.nextQuestion = function() {
        if (!answered) return;
        if (currentIndex < quiz.length - 1) {
            currentIndex += 1;
            renderQuestion();
        } else {
            optionsEl.innerHTML = '';
            qText.textContent = 'Quiz complete.';
            feedback.textContent = 'Well done! Check your results below.';
            showResults();
            nextBtn.disabled = true;
        }
    };

    window.resetQuiz = function() {
        currentIndex = 0;
        correctCount = 0;
        resultBox.style.display = 'none';
        renderQuestion();
    };

    renderQuestion();
</script>

</body>
</html>
